extends layout

block content
	.main.container
		.row
			.col-md-9.col-md-offset-1
				h1.display-4.m-b-2 Nuevo croquis

				input#camera(type="file", accept="image/*", capture="camera")
				script.
					document.getElementById('camera').onchange = function (e) {
						loadImage(
							e.target.files[0],
							function (img) {
									document.body.appendChild(img);
									var canvas = document.body.getElementsByTagName('canvas')[0];
									canvas.setAttribute('id','frame');
									InitThis();
									var mousePressed = false;
									var lastX, lastY;
									var ctx;

									function InitThis() {
										ctx = document.getElementById('frame').getContext("2d");

										$('#frame').mousedown(function (e) {
											mousePressed = true;
											console.log("down")
											Draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, false);
										});

										$('#frame').mousemove(function (e) {
											if (mousePressed) {
													Draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, true);
											}
										});

										$('#frame').mouseup(function (e) {
											mousePressed = false;
										});
											$('#frame').mouseleave(function (e) {
											mousePressed = false;
										});
									}

									function Draw(x, y, isDown) {
										if (isDown) {
											ctx.beginPath();
											ctx.lineJoin = "round";
											ctx.moveTo(lastX, lastY);
											ctx.lineTo(x, y);
											ctx.closePath();
											ctx.stroke();
										}
										lastX = x; lastY = y;
									}
										
									function clearArea() {
										// Use the identity matrix while clearing the canvas
										ctx.setTransform(1, 0, 0, 1, 0, 0);
										ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
									}
							},
							{
								maxWidth: 800,
								canvas: true,
								cover: true
							} // Options
						);
					};

